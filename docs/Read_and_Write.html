<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Reading and Writing Data</title>

<script src="site_libs/header-attrs-2.18/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/darkly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Soil Science with R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Git_and_R.html">Git and R</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Reading and Writing Data</h1>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This module introduces ways to read and write data (e.g.,
<code>.txt</code> and <code>.csv</code> files) using <code>base R</code>
functions as well as modern R packages like <code>readr</code>, which is
typically 10x faster than <code>base R</code>.</p>
<p>We will also briefly describe different ways for reading and writing
other data types such as, Excel files, google spreadsheets, or SQL
databases.</p>
<p>Note that this module derived heavily from the work of <a
href="https://www.stephaniehicks.com/jhustatcomputing2022/">Stephanie
Hicks</a>.</p>
<div id="relative-versus-absolute-paths" class="section level2">
<h2>Relative versus absolute paths</h2>
<p>When you are starting data analysis, you can create a new
<code>.Rproj</code> file that asks RStudio to change the path (location
on your computer) to the <code>.Rproj</code> location.</p>
<p>Let’s try this out. In RStudio, click <code>Project: (None)</code> in
the top right corner and <code>New Project</code>.</p>
<p>After opening up a <code>.Rproj</code> file, you can test this
by:</p>
<p><code>getwd()</code></p>
<p>When you open up someone else’s R code or analysis, you might also
see the:</p>
<p><code>setwd()</code></p>
<p>function being used which explicitly tells R to change the absolute
path or absolute location of which directory to move into.</p>
<p>For example, say I want to clone a GitHub repo from my colleague
Rufus, which has 100 R script files, and in every one of those files at
the top is:</p>
<p><code>setwd("C:\Users\Rufus\path\only\that\Rufus\has")</code></p>
<p>The problem is, if I want to use his code, I will need to go and
hand-edit every single one of those paths
(<code>C:\Users\Rufus\path\only\that\Rufus\has</code>) to the path that
I want to use on my computer or wherever I saved the folder on my
computer
(e.g. <code>/Users/JohnSmith/Documents/path/only/I/have</code>).</p>
<p>This is an unsustainable practice. I can go in and manually edit the
path, but this assumes I know how to set a working directory. Not
everyone does.</p>
<p>So instead of absolute paths:</p>
<p><code>setwd("/Users/bcaffo/data")</code>
<code>setwd("~/Desktop/files/data")</code>
<code>setwd("C:\\Users\\Michelle\\Downloads")</code></p>
<p>A better idea is to use relative paths:</p>
<p><code>setwd("../data")</code> <code>setwd("../files")</code>
<code>setwd("..\tmp")</code></p>
<p>Within R, an even better idea is to use the <a
href="https://github.com/r-lib/here">here</a> R package will recognize
the top-level directory of a Git repo and supports building all paths
relative to that. For more on project-oriented workflow suggestions,
read this <a
href="https://www.tidyverse.org/articles/2017/12/workflow-vs-script/">post</a>
from Jenny Bryan.</p>
<p>I feel this may be personal preference. The way I personally organize
my directories in GitHub and my local machine is to have a
<code>data</code> folder for all of the data I use in my project, as
well as an <code>Rscripts</code> folder to contain, you guessed it, all
of the R scripts I use. Depending on the project, I may also have a
<code>figures</code> folder or, say, an <code>Rmarkdown</code> folder to
output graphics to and collate Rmarkdown files, respectively.</p>
<p>Ultimately, I would say find what works for you and use it!</p>
</div>
<div id="the-here-package" class="section level2">
<h2>The <code>here</code> package</h2>
<p>In her post, Jenny Bryan writes:</p>
<p>“I suggest organizing each data analysis into a project: a folder on
your computer that holds all the files relevant to that particular piece
of work.”</p>
<p>Instead of using <code>setwd()</code> at the top your <code>.R</code>
or <code>.Rmd</code> file, she suggests:</p>
<ul>
<li>Organize each logical project into a folder on your computer.</li>
<li>Make sure the top-level folder advertises itself as such. This can
be as simple as having an empty file named <code>.here</code>. Or, if
you use RStudio and/or Git, those both leave characteristic files behind
that will get the job done.</li>
<li>Use the <code>here()</code> function from the here package to build
the path when you read or write a file. Create paths relative to the
top-level directory.</li>
<li>Whenever you work on this project, launch the R process from the
project’s top-level directory. If you launch R from the shell,
<code>cd</code> (think, “change directory”) to the correct folder
first.</li>
</ul>
<p>Let’s test this out. We can use <code>getwd()</code> to see our
current working directory path and the files available using
<code>list.files()</code>.</p>
<p><code>getwd()</code></p>
<pre><code>[1] &quot;/Users/JohnSmith/Documents/github/teaching/soilecology/posts/2022-09-06-reading-and-writing-data&quot;</code></pre>
<p><code>list.files()</code></p>
<pre><code>[1] &quot;index.qmd&quot;       &quot;index.rmarkdown&quot;</code></pre>
<p>OK so our current location is in the reading and writing lectures
sub-folder of the soilecology course repository. Let’s try using the
here package.</p>
<p><code>library(here)</code></p>
<p><code>list.files(here::here())</code></p>
<pre><code> [1] &quot;_freeze&quot;                    &quot;_post_template.qmd&quot;        
 [3] &quot;_quarto.yml&quot;                &quot;_site&quot;                     
 [5] &quot;data&quot;                       &quot;images&quot;                    
 [7] &quot;index.qmd&quot;                  &quot;soilecology.Rproj&quot;
 [9] &quot;lectures.qmd&quot;               &quot;posts&quot;                     
[11] &quot;profile.jpg&quot;                &quot;projects&quot;                  
[13] &quot;projects.qmd&quot;               &quot;README.md&quot;                 
[15] &quot;resources.qmd&quot;              &quot;schedule.qmd&quot;              
[17] &quot;scripts&quot;                    &quot;styles.css&quot;                
[19] &quot;syllabus.qmd&quot;               &quot;videos&quot;                    </code></pre>
<p><code>list.files(here("data"))</code></p>
<pre><code>[1] &quot;2016-07-19.csv.bz2&quot; &quot;chicago.rds&quot;        &quot;chocolate.RDS&quot;     
[4] &quot;team_standings.csv&quot;</code></pre>
<p>Now we see that using the <code>here::here()</code> function is a
relative path (relative to the <code>.Rproj</code> file in our
<code>soilecology</code> repository. We also see there is are two
<code>.csv</code> files in the data folder. We will learn how to read
those files into R in the next section.</p>
</div>
<div id="finding-and-creating-files-locally" class="section level2">
<h2>Finding and creating files locally</h2>
<p>One last thing. If you want to download a file, one way to use the
<code>file.exists()</code>, <code>dir.create()</code>, and
<code>list.files()</code> functions.</p>
<ul>
<li><code>file.exists(here("my", "relative", "path"))</code>: logical
test if the file exists</li>
<li><code>dir.create(here("my", "relative", "path"))</code>: create a
folder</li>
<li><code>list.files(here("my", "relative", "path"))</code>: list
contents of folder</li>
<li><code>file.create(here("my", "relative", "path"))</code>: create a
file</li>
<li><code>file.remove(here("my", "relative", "path"))</code>: delete a
file</li>
</ul>
<p>For example, I can put all this together by:</p>
<ol style="list-style-type: decimal">
<li><p>Checking to see if a file exists in my path. If not,
then</p></li>
<li><p>Create a directory in that path.</p></li>
<li><p>List the files in the path.</p>
<p>if(!file.exists(here(“my”, “relative”, “path”))){
dir.create(here(“my”, “relative”, “path”)) }<br />
list.files(here(“my”, “relative”, “path”))</p></li>
</ol>
<p>Let’s put relative paths to use while reading and writing data.</p>
</div>
<div id="reading-data-in-base-r" class="section level2">
<h2>Reading data in base R</h2>
<p>In this section, we’re going to demonstrate the essential functions
you need to know to read and write (or save) data in R.</p>
<div id="txt-or-csv" class="section level3">
<h3>txt or csv</h3>
<p>There are a few primary functions reading data from base R:</p>
<ul>
<li><code>read.table()</code>, <code>read.csv()</code>: for reading
tabular data</li>
<li><code>readLines()</code>: for reading lines of a text file</li>
</ul>
<p>There are analogous functions for writing data to files:</p>
<ul>
<li><code>write.table()</code>: for writing tabular data to text files
(i.e. CSV) or connections</li>
<li><code>writeLines()</code>: for writing character data line-by-line
to a file or connection</li>
</ul>
<p>Let’s try reading some data into R with the <code>read.csv()</code>
function.</p>
<p><code>df &lt;- read.csv(here("data", "team_standings.csv"))</code><br />
<code>df</code></p>
<pre><code> Standing         Team
1         1        Spain
2         2  Netherlands
3         3      Germany
4         4      Uruguay
5         5    Argentina
6         6       Brazil
7         7        Ghana
8         8     Paraguay
9         9        Japan
10       10        Chile
11       11     Portugal
12       12          USA
13       13      England
14       14       Mexico
15       15  South Korea
16       16     Slovakia
17       17  Ivory Coast
18       18     Slovenia
19       19  Switzerland
20       20 South Africa
21       21    Australia
22       22  New Zealand
23       23       Serbia
24       24      Denmark
25       25       Greece
26       26        Italy
27       27      Nigeria
28       28      Algeria
29       29       France
30       30     Honduras
31       31     Cameroon
32       32  North Korea</code></pre>
<p>We can use the <code>$</code> symbol to pick out a specific
column:</p>
<p><code>df$Team</code></p>
<pre><code> [1] &quot;Spain&quot;        &quot;Netherlands&quot;  &quot;Germany&quot;      &quot;Uruguay&quot;      &quot;Argentina&quot;   
 [6] &quot;Brazil&quot;       &quot;Ghana&quot;        &quot;Paraguay&quot;     &quot;Japan&quot;        &quot;Chile&quot;       
[11] &quot;Portugal&quot;     &quot;USA&quot;          &quot;England&quot;      &quot;Mexico&quot;       &quot;South Korea&quot; 
[16] &quot;Slovakia&quot;     &quot;Ivory Coast&quot;  &quot;Slovenia&quot;     &quot;Switzerland&quot;  &quot;South Africa&quot;
[21] &quot;Australia&quot;    &quot;New Zealand&quot;  &quot;Serbia&quot;       &quot;Denmark&quot;      &quot;Greece&quot;      
[26] &quot;Italy&quot;        &quot;Nigeria&quot;      &quot;Algeria&quot;      &quot;France&quot;       &quot;Honduras&quot;    
[31] &quot;Cameroon&quot;     &quot;North Korea&quot; </code></pre>
<p>We can also ask for the full paths for specific files</p>
<p><code>here("data", "team_standings.csv")</code></p>
<pre><code>[1] &quot;/Users/JohnSmith/Documents/github/teaching/soilecology/data/team_standings.csv&quot;</code></pre>
</div>
</div>
<div id="r-code" class="section level2">
<h2>R code</h2>
<p>Sometimes, someone will give you a file that ends in a
<code>.R</code>.</p>
<p>This is what’s called an <em>R script</em> file. It may contain code
someone has written (maybe even you!), for example, a function that you
can use with your data. In this case, you want the function available
for you to use.</p>
<p>To use the function, you have to first read in the function from
<em>R script</em> file into R.</p>
<p>You can check to see if the function already is loaded in R by
looking at the Environment tab.</p>
<p>The function you want to use is:</p>
<p><code>source()</code>: for reading in R code files</p>
<p>For example, it might be something like this:</p>
<p><code>source(here::here('functions.R'))</code></p>
</div>
<div id="r-objects" class="section level2">
<h2>R objects</h2>
<p>Alternatively, you might be interested in reading and writing R
objects.</p>
<p>Writing data in e.g., <code>.txt</code>, <code>.csv</code> or
<code>Excel</code> file formats is good if you want to open these files
with other analysis software, such as Excel. However, these formats do
not preserve data structures, such as column data types (numeric,
character or factor). In order to do that, the data should be written
out in a R data format.</p>
<p>There are several types R data file formats to be aware of:</p>
<ul>
<li><code>.RData</code>: Stores multiple R objects</li>
<li><code>.Rda</code>: This is short for <code>.RData</code> and is
equivalent.</li>
<li><code>.Rds</code>: Stores a single R object</li>
</ul>
<p>Saving data into <code>R data</code> formats can typically reduce
considerably the size of large files by compression.</p>
<p>Next, we will learn how to read and save:</p>
<ol style="list-style-type: decimal">
<li>A single R object</li>
<li>Multiple R objects</li>
<li>Your entire work space in a specified file</li>
</ol>
</div>
<div id="reading-in-data-from-files" class="section level2">
<h2>Reading in data from files</h2>
<ul>
<li><code>load()</code>: for reading in single or multiple R objects
(opposite of <code>save()</code>) with a <code>.Rda</code> or
<code>.RData</code> file format (objects must be same name)</li>
<li><code>readRDS()</code>: for reading in a single object with a
<code>.Rds</code> file format (can rename objects)</li>
<li><code>unserialize()</code>: for reading single R objects in binary
form</li>
</ul>
</div>
<div id="writing-data-to-files" class="section level2">
<h2>Writing data to files</h2>
<ul>
<li><code>save()</code>: for saving an arbitrary number of R objects in
binary format (possibly compressed) to a file.</li>
<li><code>saveRDS()</code>: for saving a single object</li>
<li><code>serialize()</code>: for converting an R object into a binary
format for outputting to a connection (or file).</li>
<li><code>save.image()</code>: short for ‘save my current workspace’;
while this sounds nice, it’s not terribly useful for reproducibility
(hence not suggested); it’s also what happens when you try to quit R and
it asks if you want to save your work space.</li>
</ul>
<p><em>Example</em></p>
<p>Let’s try an example. Let’s save a vector of length 5 into the two
file formats.</p>
<p><code>x &lt;- 1:5</code><br />
<code>save(x, file=here("data", "x.Rda"))</code><br />
<code>saveRDS(x, file=here("data", "x.Rds"))</code><br />
<code>list.files(path=here("data"))</code></p>
<pre><code>[1] &quot;2016-07-19.csv.bz2&quot; &quot;chicago.rds&quot;        &quot;chocolate.RDS&quot;     
[4] &quot;team_standings.csv&quot; &quot;x.Rda&quot;              &quot;x.Rds&quot;</code></pre>
<p>Here we assign the imported data to an object using
<code>readRDS()</code>:</p>
<p><code>new_x1 &lt;- readRDS(here("data", "x.Rds"))</code><br />
<code>new_x1</code></p>
<pre><code>[1] 1 2 3 4 5</code></pre>
<p>Here we assign the imported data to an object using
<code>load()</code>:</p>
<p><code>new_x2 &lt;- load(here("data", "x.Rda"))</code><br />
<code>new_x2</code></p>
<pre><code>[1] &quot;x&quot;</code></pre>
<p><em>Note</em></p>
<p><code>load()</code> simply returns the name of the objects loaded.
Not the values.</p>
<p>Let’s clean up our space.</p>
<p><code>file.remove(here("data", "x.Rda"))</code></p>
<pre><code>[1] TRUE</code></pre>
<p><code>file.remove(here("data", "x.Rds"))</code></p>
<pre><code>[1] TRUE</code></pre>
<p><code>rm(x)</code></p>
<p><code>x &lt;- 1:5</code><br />
<code>y &lt;- x^2</code><br />
<code>save(x,y, file=here("data", "x.Rda"))</code><br />
<code>new_x2 &lt;- load(here("data", "x.Rda"))</code></p>
<p>When you are done:</p>
<p><code>file.remove(here("data", "x.Rda"))</code></p>
<div id="other-data-types" class="section level3">
<h3>Other data types</h3>
<p>Now, there are of course, many R packages that have been developed to
read in all kinds of other datasets, and you may need to resort to one
of these packages if you are working in a specific area.</p>
<p>For example, check out</p>
<ul>
<li><a href="https://github.com/r-dbi/DBI">DBI</a> for relational
databases</li>
<li><a href="https://haven.tidyverse.org/">haven</a> for SPSS, Stata,
and SAS data</li>
<li><a href="https://github.com/r-lib/httr">httr</a> for web APIs</li>
<li><a href="https://readxl.tidyverse.org/">readxl</a> for .xls and
.xlsx sheets</li>
<li><a href="https://googlesheets4.tidyverse.org/">googlesheets4</a> for
Google Sheets</li>
<li><a href="https://googledrive.tidyverse.org/">googledrive</a> for
Google Drive files</li>
<li><a href="https://github.com/tidyverse/rvest">rvest</a> for web
scraping</li>
<li><a href="https://github.com/jeroen/jsonlite#jsonlite">jsonlite</a>
for JSON</li>
<li><a href="https://github.com/r-lib/xml2">xml2</a> for XML.</li>
<li><a
href="https://cran.r-project.org/web/packages/mongolite/">mongolite</a>
for interacting with <a
href="https://www.mongodb.com/languages/mongodb-and-r-example">MongoDB</a>.</li>
</ul>
</div>
</div>
</div>
<div id="reading-data-files-with-read.table" class="section level1">
<h1>Reading data files with read.table()</h1>
<p>The <code>read.table()</code> function is one of the most commonly
used functions for reading data. The help file for
<code>read.table()</code> is worth reading in its entirety if only
because the function gets used a lot (run <code>?read.table</code> in
R).</p>
<div id="reading-in-larger-datasets-with-read.table"
class="section level2">
<h2>Reading in larger datasets with <code>read.table()</code></h2>
<p>The <code>read.table()</code> function has a few important
arguments:</p>
<ul>
<li><code>file</code>, the name of a file, or a connection</li>
<li><code>header</code>, logical indicating if the file has a header
line</li>
<li><code>sep</code>, a string indicating how the columns are
separated</li>
<li><code>colClasses</code>, a character vector indicating the class of
each column in the dataset</li>
<li><code>nrows</code>, the number of rows in the dataset. By default
read.table() reads an entire file.</li>
<li><code>comment.char</code>, a character string indicating the comment
character. This defaults to “#”. If there are no commented lines in your
file, it’s worth setting this to be the empty string ““.</li>
<li><code>skip</code>, the number of lines to skip from the
beginning</li>
<li><code>stringsAsFactors</code>, should character variables be coded
as factors? This defaults to <code>FALSE.</code> However, back in the
“old days”, it defaulted to <code>TRUE.</code> The reason for this was
because if you had data that were stored as strings, it was because
those strings represented levels of a categorical variable. Now, we have
lots of data that is text data and they do not always represent
categorical variables. So you may want to set this to be FALSE in those
cases. If you always want this to be <code>FALSE</code>, you can set a
global option via options(stringsAsFactors = <code>FALSE</code>).</li>
</ul>
<p>I’ve never seen so much heat generated on discussion forums about an
R function argument than the <code>stringsAsFactors</code> argument.
Seriously.</p>
<p>For small to moderately sized datasets, you can usually call
<code>read.table()</code> without specifying any other arguments</p>
<p><code>data &lt;- read.table("foo.txt")</code></p>
<p>Note that <code>foo.txt</code> is not a real dataset here. It is only
used as an example for how to use <code>read.table()</code>.</p>
<p>In this case, R will automatically:</p>
<ul>
<li>skip lines that begin with a #</li>
<li>figure out how many rows there are (and how much memory needs to be
allocated)</li>
<li>figure what type of variable is in each column of the table.</li>
</ul>
<p>Telling R all these things directly makes R run faster and more
efficiently.</p>
<p>Note that the <code>read.csv()</code> function is identical to
<code>read.table()</code> except that some of the defaults are set
differently (like the <code>sep</code> argument).</p>
</div>
<div id="reading-in-larger-datasets-with-read.table-1"
class="section level2">
<h2>Reading in larger datasets with <code>read.table()</code></h2>
<p>With much larger datasets, there are a few things that you can do
that will make your life easier and will prevent R from choking.</p>
<ul>
<li><p>Read the help page for <code>read.table()</code>, which contains
many hints.</p></li>
<li><p>Make a rough calculation of the memory required to store your
dataset (see the next section for an example of how to do this). If the
dataset is larger than the amount of RAM on your computer, you can
probably stop right here.</p></li>
<li><p>Set <code>comment.char = ""</code> if there are no commented
lines in your file.</p></li>
<li><p>Use the <code>colClasses</code> argument. Specifying this option
instead of using the default can make <code>read.table()</code> run MUCH
faster, often twice as fast. In order to use this option, you have to
know the class of each column in your data frame. If all of the columns
are “numeric”, for example, then you can just set
<code>colClasses = "numeric"</code>. A quick an dirty way to figure out
the classes of each column is the following:</p>
<p>initial &lt;- read.table(“datatable.txt”, nrows = 100) classes &lt;-
sapply(initial, class) tabAll &lt;- read.table(“datatable.txt”,
colClasses = classes)</p></li>
</ul>
<p>Note: <code>datatable.txt</code> is not a real dataset here. It is
only used as an example for how to use <code>read.table()</code>.</p>
<p>Set <code>nrows</code>. This does not make R run faster but it helps
with memory usage. A mild overestimate is okay. You can use the Unix
tool <code>wc</code> to calculate the number of lines in a file. In
general, when using R with larger datasets, it’s also useful to know a
few things about your system:</p>
<ul>
<li>How much memory is available on your system?</li>
<li>What other applications are in use? Can you close any of them?</li>
<li>Are there other users logged into the same system?</li>
<li>What operating system ar you using? Some operating systems can limit
the amount of memory a single process can access</li>
</ul>
</div>
<div id="calculating-memory-requirements-for-r-objects"
class="section level2">
<h2>Calculating Memory Requirements for R Objects</h2>
<p>Because R stores all of its objects in physical memory, it is
important to be cognizant of how much memory is being used up by all of
the data objects residing in your workspace.</p>
<p>One situation where it is particularly important to understand memory
requirements is when you are reading in a new dataset into R.
Fortunately, it is easy to make a back of the envelope calculation of
how much memory will be required by a new dataset.</p>
<p>For example, suppose I have a data frame with 1,500,000 rows and 120
columns, all of which are numeric data. Roughly, how much memory is
required to store this data frame?</p>
<p>Well, on most modern computers double precision floating point
numbers are stored using 64 bits of memory, or 8 bytes. Given that
information, you can do the following calculation:</p>
<pre><code>1,500,000 × 120 × 8 bytes/numeric = 1,440,000,000 bytes

= 1,440,000,000 / 220 bytes/MB

= 1,373.29 MB

= 1.34 GB</code></pre>
<p>So the dataset would require about 1.34 GB of RAM. Most computers
these days have at least that much RAM. However, you need to be aware
of:</p>
<ol style="list-style-type: decimal">
<li>What other programs might be running on your computer and using up
RAM.</li>
<li>What other R objects might already be taking up RAM in your
workspace.</li>
</ol>
<p>Reading in a large dataset for which you do not have enough RAM is
one easy way to freeze up your computer (or at least your R session).
This is usually an unpleasant experience that usually requires you to
kill the R process, in the best case scenario, or reboot your computer,
in the worst case. So make sure to do a rough calculation of memory
requirements before reading in a large dataset. You’ll thank me
later.</p>
</div>
<div id="using-the-readr-package" class="section level2">
<h2>Using the readr package</h2>
<p>The <code>readr</code> package was developed by Posit (formerly known
as RStudio) to deal with reading in large flat files quickly.</p>
<p>The package provides replacements for functions like
<code>read.table()</code> and <code>read.csv()</code>. The analogous
functions in <code>readr</code> are <code>read_table()</code> and
<code>read_csv()</code>. These functions are often much faster than
their base R analogues and provide a few other nice features such as
progress meters.</p>
<p>For example, the package includes a variety of functions in the
<code>read_*()</code> family that allow you to read in data from
different formats of flat files. The following table gives a guide to
several functions in the <code>read_*()</code> family:</p>
<pre><code>readr function  Use
read_csv()      Reads comma-separated file
read_csv2()     Reads semicolon-separated file
read_tsv()      Reads tab-separated file
read_delim()    General function for reading delimited files
read_fwf()      Reads fixed width files
read_log()      Reads log files</code></pre>
<p><em>Note</em></p>
<p>In this code, I used the <code>kable()</code> function from the
<code>knitr</code> package to create the summary table in a table
format, rather than as basic R output.</p>
<p>This function is very useful for formatting basic tables in R
markdown documents. For more complex tables, check out the
<code>pander</code> and <code>xtable</code> packages.</p>
<p>For the most part, you can read use <code>read_table()</code> and
<code>read_csv()</code> pretty much anywhere you might use
<code>read.table()</code> and <code>read.csv()</code>.</p>
<p>In addition, if there are non-fatal problems that occur while reading
in the data, you will get a warning and the returned data frame will
have some information about which rows/observations triggered the
warning.</p>
<p>This can be very helpful for “debugging” problems with your data
before you get neck deep in data analysis.</p>
<div id="advantages" class="section level3">
<h3>Advantages</h3>
<p>The advantage of the <code>read_csv()</code> function is perhaps
better understood from an historical perspective.</p>
<p>R’s built in <code>read.csv()</code> function similarly reads CSV
files, but the <code>read_csv()</code> function in <code>readr</code>
builds on that by removing some of the quirks and “gotchas” of
<code>read.csv()</code> as well as dramatically optimizing the speed
with which it can read data into R.</p>
<p>The <code>read_csv()</code> function also adds some nice
user-oriented features like a progress meter and a compact method for
specifying column types.</p>
<p><em>Example</em></p>
<p>A typical call to <code>read_csv()</code> will look as follows:</p>
<pre><code>library(readr)
teams &lt;- read_csv(here(&quot;data&quot;, &quot;team_standings.csv&quot;))

Rows: 32 Columns: 2
── Column specification ────────────────────────────────────────────────────────
Delimiter: &quot;,&quot;
chr (1): Team
dbl (1): Standing

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
teams

# A tibble: 32 × 2
   Standing Team       
      &lt;dbl&gt; &lt;chr&gt;      
 1        1 Spain      
 2        2 Netherlands
 3        3 Germany    
 4        4 Uruguay    
 5        5 Argentina  
 6        6 Brazil     
 7        7 Ghana      
 8        8 Paraguay   
 9        9 Japan      
10       10 Chile      
# … with 22 more rows</code></pre>
<p>By default, <code>read_csv()</code> will open a CSV file and read it
in line-by-line. Similar to <code>read.table()</code>, you can tell the
function to skip lines or which lines are comments:</p>
<pre><code>read_csv(&quot;The first line of metadata
  The second line of metadata
  x,y,z
  1,2,3&quot;,
  skip = 2)

Rows: 1 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: &quot;,&quot;
dbl (3): x, y, z

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
# A tibble: 1 × 3
      x     y     z
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1     2     3</code></pre>
<p>Alternatively, you can use the comment argument:</p>
<pre><code>read_csv(&quot;# A comment I want to skip
  x,y,z
  1,2,3&quot;,
  comment = &quot;#&quot;)

Rows: 1 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: &quot;,&quot;
dbl (3): x, y, z

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
# A tibble: 1 × 3
      x     y     z
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1     2     3</code></pre>
<p>It will also (by default), read in the first few rows of the table to
figure out the type of each column (i.e., integer, character, etc.).
From the <code>read_csv()</code> help page:</p>
<pre><code>If ‘NULL’, all column types will be imputed from the first 1000 rows on the input. This is convenient (and fast), but not robust. If the imputation fails, you’ll need to supply the correct types yourself.</code></pre>
<p>You can specify the type of each column with the
<code>col_types</code> argument.</p>
<p><em>Note</em></p>
<p>In general, it is a good idea to specify the column types
explicitly.</p>
<p>This rules out any possible guessing errors on the part of
<code>read_csv()</code>.</p>
<p>Also, specifying the column types explicitly provides a useful safety
check in case anything about the dataset should change without you
knowing about it.</p>
<p>Here is an example of how to specify the column types explicitly:</p>
<pre><code>teams &lt;- read_csv(here(&quot;data&quot;, &quot;team_standings.csv&quot;), col_types = &quot;cc&quot;)</code></pre>
<p>Note that the <code>col_types</code> argument accepts a compact
representation. Here “cc” indicates that the first column is character
and the second column is character (there are only two columns). Using
the col_types argument is useful because often it is not easy to
automatically figure out the type of a column by looking at a few rows
(especially if a column has many missing values).</p>
<p><em>Note</em></p>
<p>The <code>read_csv()</code> function will also read compressed files
automatically.</p>
<p>There is no need to decompress the file first or use the gzfile
connection function.</p>
<p>The following call reads a gzip-compressed CSV file containing
download logs from the RStudio CRAN mirror.</p>
<pre><code>logs &lt;- read_csv(here(&quot;data&quot;, &quot;2016-07-19.csv.bz2&quot;), 
                 n_max = 10)

Rows: 10 Columns: 10
── Column specification ────────────────────────────────────────────────────────
Delimiter: &quot;,&quot;
chr  (6): r_version, r_arch, r_os, package, version, country
dbl  (2): size, ip_id
date (1): date
time (1): time

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>Note that the warnings indicate that <code>read_csv()</code> may have
had some difficulty identifying the type of each column. This can be
solved by using the <code>col_types</code> argument.</p>
<pre><code>logs &lt;- read_csv(here(&quot;data&quot;, &quot;2016-07-19.csv.bz2&quot;), 
                 col_types = &quot;ccicccccci&quot;, 
                 n_max = 10)
logs

# A tibble: 10 × 10
   date       time       size r_ver…¹ r_arch r_os  package version country ip_id
   &lt;chr&gt;      &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt;
 1 2016-07-19 22:00:00 1.89e6 3.3.0   x86_64 ming… data.t… 1.9.6   US          1
 2 2016-07-19 22:00:05 4.54e4 3.3.1   x86_64 ming… assert… 0.1     US          2
 3 2016-07-19 22:00:03 1.43e7 3.3.1   x86_64 ming… stringi 1.1.1   DE          3
 4 2016-07-19 22:00:05 1.89e6 3.3.1   x86_64 ming… data.t… 1.9.6   US          4
 5 2016-07-19 22:00:06 3.90e5 3.3.1   x86_64 ming… foreach 1.4.3   US          4
 6 2016-07-19 22:00:08 4.88e4 3.3.1   x86_64 linu… tree    1.0-37  CO          5
 7 2016-07-19 22:00:12 5.25e2 3.3.1   x86_64 darw… surviv… 2.39-5  US          6
 8 2016-07-19 22:00:08 3.23e6 3.3.1   x86_64 ming… Rcpp    0.12.5  US          2
 9 2016-07-19 22:00:09 5.56e5 3.3.1   x86_64 ming… tibble  1.1     US          2
10 2016-07-19 22:00:10 1.52e5 3.3.1   x86_64 ming… magrit… 1.5     US          2
# … with abbreviated variable name ¹​r_version</code></pre>
<p>You can specify the column type in a more detailed fashion by using
the various <code>col_*()</code> functions.</p>
<p>For example, in the log data above, the first column is actually a
date, so it might make more sense to read it in as a <code>Date</code>
object.</p>
<p>If we wanted to just read in that first column, we could do</p>
<pre><code>logdates &lt;- read_csv(here(&quot;data&quot;, &quot;2016-07-19.csv.bz2&quot;), 
                     col_types = cols_only(date = col_date()),
                     n_max = 10)
logdates

# A tibble: 10 × 1
   date      
   &lt;date&gt;    
 1 2016-07-19
 2 2016-07-19
 3 2016-07-19
 4 2016-07-19
 5 2016-07-19
 6 2016-07-19
 7 2016-07-19
 8 2016-07-19
 9 2016-07-19
10 2016-07-19</code></pre>
<p>Now the date column is stored as a <code>Date</code> object which can
be used for relevant date-related computations (for example, see the
<code>lubridate</code> package).</p>
<p><em>Note</em></p>
<p>The <code>read_csv()</code> function has a progress option that
defaults to <code>TRUE</code>.</p>
<p>This options provides a nice progress meter while the CSV file is
being read.</p>
<p>However, if you are using <code>read_csv()</code> in a function, or
perhaps embedding it in a loop, it is probably best to set
<code>progress = FALSE</code>.</p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
